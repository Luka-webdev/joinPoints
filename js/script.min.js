$(function(){const i=$(".board"),o=i.width(),a=i.height();let c=50,r=3,n=0,l=0;var t=o/c+1;const s=t*(a/c+1);let e=Math.floor(s/2),d,h=[-t-1,-t,1-t,-1,1,t-1,t,1+t],u,f,v=[],g=!0,m,k=!0,y=!1;const b=$(".msg"),p=$(".playAgain"),P=$(".showRules"),I=$(".gameRules"),T=$(".play");P.on("click",function(){$(".welcomeScreen").addClass("visibility"),$(".gameRules").removeClass("visibility")}),T.on("click",function(){I.addClass("visibility"),$(".gameBoard").removeClass("visibility")});var C=a/c/2-1,M=a/c/2,w=a/c/2+1;const A=[C*t,M*t,w*t],S=[(1+C)*t-1,(1+M)*t-1,(1+w)*t-1],R=document.querySelector("canvas"),W=R.getContext("2d");function X(){function t(t,e){W.beginPath(),W.moveTo(t,a/2-2*c),W.lineTo(e,a/2-2*c),W.lineTo(e,a/2+2*c),W.lineTo(t,a/2+2*c),W.stroke()}function e(t,e){W.beginPath(),W.moveTo(t,a/2),W.lineTo(t,a/2-c),W.lineTo(t,a/2+c),W.strokeStyle=e,W.stroke()}function i(t,e,i){W.beginPath(),W.arc(t,e,c/2,0,.5*Math.PI,i),W.strokeStyle="white",W.stroke()}function n(t,e){W.beginPath(),W.arc(t,a/2,c,.5*Math.PI,1.5*Math.PI,e),W.stroke()}W.beginPath(),W.moveTo(o/2,0),W.lineTo(o/2,a),W.closePath(),W.lineWidth=8,W.strokeStyle="white",W.stroke(),W.beginPath(),W.arc(o/2,a/2,2*c,0,2*Math.PI,!0),W.stroke(),t(0,2*c),t(o,o-2*c),e(0,"green"),e(o,"red"),i(0,0,!1),i(o,0,!0),i(0,a,!0),i(o,a,!0),n(2*c,!0),n(o-2*c,!1)}function Y(){d.removeClass("center"),$(".active").removeClass("active").off("click",q),g=!g}function x(t){var e,i,n,o;Y(),o=m,centerX=parseInt(d.css("left")),centerY=parseInt(d.css("top")),moveX=parseInt($("#"+o).css("left")),moveY=parseInt($("#"+o).css("top")),u=d.attr("id"),f=$("#"+o).attr("id"),v.push(u+"-"+f),e=centerX,i=centerY,n=moveX,o=moveY,t=t,W.beginPath(),W.moveTo(e+r,i+r),W.lineTo(n+r,o+r),W.lineWidth=6,W.strokeStyle=t,W.stroke(),B(m),function(){arrayActualId=[];let t=$(".active");t.each(function(){arrayActualId.push($(this).attr("id"))})}()}function z(){b.addClass("visibility"),Y(),$(".point").removeAttr("clicked"),W.clearRect(0,0,o,a),e=Math.floor(s/2),v.length=0,g=!0,k=!0,y=!1,X(),B(e)}function N(t){y=!0,b.removeClass("visibility"),$(".msg h2").text(t),p.on("click",z)}function q(){g&&(m=Number($(this).attr("id")),x("green"),g=!!$(this).attr("clicked")||($(this).attr("clicked",!0),!1)),!1===g&&function t(){void 0!==arrayActualId[0]||!1!==y?setTimeout(function(){m=Number(arrayActualId[0]),x("red"),$("#"+m).attr("clicked")?(g=!1,t()):($("#"+m).attr("clicked",!0),g=!0)},1e3):N("Wygrałeś")}()}function B(i){if(!function(e){for(let t=0;t<S.length;t++)(S[t]==e&&0==g||S[t]==e&&1==g)&&N("Wygrałeś");for(let t=0;t<A.length;t++)(A[t]==e&&1==g||A[t]==e&&0==g)&&N("Przegrałeś")}(i),i===Math.floor(s/2)&&$("#"+i).attr("clicked",!0),!y){d=$("#"+i),d.addClass("center");for(let e=0;e<h.length;e++)if(!1===v.includes(i+"-"+(i+h[e]))&&!1===v.includes(i+h[e]+"-"+i)){let t=$("#"+(i+h[e]));t.addClass("active"),t.on("click",q)}0===$(".active").length&&!1===g&&N("Przegrałeś")}}R.width=o,R.height=a,X(),function(){for(let t=0;t<s;t++){var e=$("<div></div>",{class:"point",id:t,css:{top:l-r,left:n-r}});i.append(e),n>=o?(l+=c,n=0):n<o&&(n+=c)}}(),B(e)});